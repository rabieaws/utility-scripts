replacements:
  addl_regions:
    a:
      - ${HOME_REGION}
    b:
      - ${HOME_REGION}
      - ${GBL_REGION}
    c:
      - ${HOME_REGION}
      - ${GBL_REGION}
      - us-east-2
      - us-west-1
      - us-west-2
  cloud-cidr1: 10.0.0.0
  cloud-mask1: 255.0.0.0
  cloud-cidr2: 100.96.194.0
  cloud-mask2: 255.255.254.0
  range-restrict:
    - 10.0.0.0/8
    - 100.96.194.0/23
    - 100.96.190.0/23
  range-dev-test:
    - 0.0.0.0/0
  alarm-not-ip: 10.10.10.*
global-options:
  alz-minimum-version: v2.3.1
  meta-data-collection: true
  ct-baseline: false
  default-s3-retention: 90
  central-bucket: pbmm-ised-accelerator-test-config
  organization-admin-role: AWSCloudFormationStackSetExecutionRole
  default-cwl-retention: 731
  workloadaccounts-suffix: 1
  workloadaccounts-prefix: config
  workloadaccounts-param-filename: config.yaml
  ignored-ous:
    - Unmanaged
  additional-global-output-regions: []
  supported-regions:
    - ap-northeast-1
    - ap-northeast-2
    - ap-northeast-3
    - ap-south-1
    - ap-southeast-1
    - ap-southeast-2
    - ca-central-1
    - eu-central-1
    - eu-north-1
    - eu-west-1
    - eu-west-2
    - eu-west-3
    - sa-east-1
    - us-east-1
    - us-east-2
    - us-west-1
    - us-west-2
  keep-default-vpc-regions: []
  aws-org-management:
    account: master
    region: ${HOME_REGION}
    add-sns-topics: true
  central-security-services:
    account: security
    region: ${HOME_REGION}
    security-hub-excl-regions: []
    security-hub: true
    guardduty: true
    guardduty-excl-regions: []
    guardduty-s3: true
    guardduty-s3-excl-regions: []
    cwl: true
    access-analyzer: true
    config-excl-regions: []
    config-aggr-excl-regions: []
    macie: true
    macie-excl-regions: []
    macie-frequency: FIFTEEN_MINUTES
    macie-sensitive-sh: true
    fw-mgr-alert-level: Low
    security-hub-findings-sns: Low
    add-sns-topics: true
  central-operations-services:
    account: operations
    region: ${HOME_REGION}
    cwl: true
    cwl-access-level: full
    config-aggr: true
  central-log-services:
    account: log-archive
    region: ${HOME_REGION}
    s3-retention: 730
    cwl-glbl-exclusions: []
    cwl-exclusions: []
    ssm-to-s3: true
    ssm-to-cwl: true
    sns-excl-regions: []
    sns-subscription-emails:
      High:
        - matarneh+awsalert-alerteaws@amazon.com
    dynamic-s3-log-partitioning:
      - logGroupPattern: /${ACCELERATOR_PREFIX_ND}/MAD
        s3Prefix: managed-ad
      - logGroupPattern: /${ACCELERATOR_PREFIX_ND}/rql
        s3Prefix: rql
      - logGroupPattern: /${ACCELERATOR_PREFIX_ND}/SecurityHub
        s3Prefix: security-hub
      - logGroupPattern: /${ACCELERATOR_PREFIX_ND}/Nfw
        s3Prefix: nfw
      - logGroupPattern: /${ACCELERATOR_PREFIX_ND}/rsyslog
        s3Prefix: rsyslog
      - logGroupPattern: /${ACCELERATOR_PREFIX_ND}/SSM
        s3Prefix: ssm
      - logGroupPattern: /${ACCELERATOR_PREFIX_ND}/flowlogs
        s3Prefix: vpcflowlogs
  additional-cwl-regions: {}
  reports:
    cost-and-usage-report:
      additional-schema-elements:
        - RESOURCES
      compression: Parquet
      format: Parquet
      report-name: Cost-and-Usage-Report
      s3-prefix: cur
      time-unit: HOURLY
      additional-artifacts:
        - ATHENA
      refresh-closed-reports: true
      report-versioning: OVERWRITE_REPORT
  vpc-flow-logs:
    filter: ALL
    interval: 60
    default-format: false
    custom-fields:
      - version
      - account-id
      - interface-id
      - srcaddr
      - dstaddr
      - srcport
      - dstport
      - protocol
      - packets
      - bytes
      - start
      - end
      - action
      - log-status
      - vpc-id
      - subnet-id
      - instance-id
      - tcp-flags
      - type
      - pkt-srcaddr
      - pkt-dstaddr
      - region
      - az-id
      - pkt-src-aws-service
      - pkt-dst-aws-service
      - flow-direction
      - traffic-path
  security-hub-frameworks:
    standards:
      - name: CIS AWS Foundations Benchmark v1.4.0
        controls-to-disable: []
  iam-password-policies:
    allow-users-to-change-password: true
    hard-expiry: false
    require-uppercase-characters: true
    require-lowercase-characters: true
    require-symbols: true
    require-numbers: true
    minimum-password-length: 14
    password-reuse-prevention: 24
    max-password-age: 90
  scps:
    - name: Guardrails-Part-0
      description: ASEA Guardrails Part 0 Workload Accounts
      policy: ASEA-Guardrails-Part0-WkldOUs.json
    - name: Guardrails-Part-0-Core
      description: ASEA Guardrails Part 0 Core Accounts
      policy: ASEA-Guardrails-Part0-CoreOUs.json
    - name: Guardrails-Part-1
      description: ASEA Guardrails Part 1
      policy: ASEA-Guardrails-Part1.json
    # - name: Guardrails-ISED
    #   description: ASEA Guardrails ISED Specific
    #   policy: ASEA-Guardrails-ISED.json
    # - name: Guardrails-ISED-Public-Buckets-Scp
    #   description: ASEA Guardrails Public-Buckets ISED Specific
    #   policy: ASEA-Guardrails-ISED-Public-Buckets-Scp.json
    - name: Guardrails-Sensitive
      description: ASEA Guardrails Sensitive Environment Specific
      policy: ASEA-Guardrails-Sensitive.json
    - name: Guardrails-Unclass
      description: ASEA Guardrails Unclassified Environment Specific
      policy: ASEA-Guardrails-Unclass.json
    - name: Guardrails-Sandbox
      description: ASEA Guardrails Sandbox Environment Specific
      policy: ASEA-Guardrails-Sandbox.json
    - name: Quarantine-New-Object
      description: ASEA Quarantine policy - Apply to ACCOUNTS that need to be quarantined
      policy: Quarantine-New-Object.json
  cloudwatch:
    metrics:
      - filter-name: SecurityGroupChangeMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = AuthorizeSecurityGroupIngress) || ($.eventName =
          AuthorizeSecurityGroupEgress) || ($.eventName =
          RevokeSecurityGroupIngress) || ($.eventName =
          RevokeSecurityGroupEgress) || ($.eventName = CreateSecurityGroup) ||
          ($.eventName = DeleteSecurityGroup) }
        metric-namespace: CloudTrailMetrics
        metric-name: SecurityGroupEventCount
        metric-value: '1'
      - filter-name: NetworkAclChangeMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = CreateNetworkAcl) || ($.eventName =
          CreateNetworkAclEntry) || ($.eventName = DeleteNetworkAcl) ||
          ($.eventName = DeleteNetworkAclEntry) || ($.eventName =
          ReplaceNetworkAclEntry) || ($.eventName =
          ReplaceNetworkAclAssociation)}
        metric-namespace: CloudTrailMetrics
        metric-name: NetworkAclEventCount
        metric-value: '1'
      - filter-name: GatewayChangeMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = CreateCustomerGateway) || ($.eventName =
          DeleteCustomerGateway) || ($.eventName = AttachInternetGateway) ||
          ($.eventName = CreateInternetGateway) || ($.eventName =
          DeleteInternetGateway) || ($.eventName = DetachInternetGateway)}
        metric-namespace: CloudTrailMetrics
        metric-name: GatewayEventCount
        metric-value: '1'
      - filter-name: VpcChangeMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = CreateVpc) || ($.eventName = DeleteVpc) ||
          ($.eventName = ModifyVpcAttribute) || ($.eventName =
          AcceptVpcPeeringConnection) || ($.eventName =
          CreateVpcPeeringConnection) || ($.eventName =
          DeleteVpcPeeringConnection) || ($.eventName =
          RejectVpcPeeringConnection) || ($.eventName = AttachClassicLinkVpc) ||
          ($.eventName = DetachClassicLinkVpc) || ($.eventName =
          DisableVpcClassicLink) || ($.eventName = EnableVpcClassicLink) }
        metric-namespace: CloudTrailMetrics
        metric-name: VpcEventCount
        metric-value: '1'
      - filter-name: Ec2InstanceChangeMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = RunInstances) || ($.eventName = RebootInstances)||
          ($.eventName = StartInstances) || ($.eventName = StopInstances) ||
          ($.eventName= TerminateInstances) }
        metric-namespace: CloudTrailMetrics
        metric-name: EC2InstanceEventCount
        metric-value: '1'
      - filter-name: Ec2LargeInstanceChangeMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { (($.eventName = RunInstances) || ($.eventName = RebootInstances)||
          ($.eventName = StartInstances) || ($.eventName = StopInstances) ||
          ($.eventName= TerminateInstances)) &&
          (($.requestParameters.instanceType= *.32xlarge) ||
          ($.requestParameters.instanceType= *.24xlarge) ||
          ($.requestParameters.instanceType= *.18xlarge) ||
          ($.requestParameters.instanceType= *.16xlarge) ||
          ($.requestParameters.instanceType= *.12xlarge) ||
          ($.requestParameters.instanceType= *.10xlarge) ||
          ($.requestParameters.instanceType= *.9xlarge) ||
          ($.requestParameters.instanceType= *.8xlarge) ||
          ($.requestParameters.instanceType = *.4xlarge)) }
        metric-namespace: CloudTrailMetrics
        metric-name: EC2LargeInstanceEventCount
        metric-value: '1'
      - filter-name: CloudTrailChangeMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = CreateTrail) || ($.eventName = UpdateTrail)||
          ($.eventName = DeleteTrail) || ($.eventName = StartLogging) ||
          ($.eventName= StopLogging) }
        metric-namespace: CloudTrailMetrics
        metric-name: CloudTrailEventCount
        metric-value: '1'
      - filter-name: ConsoleSignInFailureMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = ConsoleLogin) && ($.errorMessage =
          "Failedauthentication") }
        metric-namespace: CloudTrailMetrics
        metric-name: ConsoleSignInFailureCount
        metric-value: '1'
      - filter-name: AuthorizationFailureMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { (($.errorCode = "*UnauthorizedOperation") || ($.errorCode
          ="AccessDenied*") && ($.userIdentity.principalId !=
          "*AWSConfig-BucketConfigCheck")) }
        metric-namespace: CloudTrailMetrics
        metric-name: AuthorizationFailureCount
        metric-value: '1'
      - filter-name: IamPolicyChangesMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.eventName=DeleteGroupPolicy)||($.eventName=DeleteRolePolicy)||($.eventName=DeleteUserPolicy)||($.eventName=PutGroupPolicy)||($.eventName=PutRolePolicy)||($.eventName=PutUserPolicy)||($.eventName=CreatePolicy)||($.eventName=DeletePolicy)||($.eventName=CreatePolicyVersion)||($.eventName=DeletePolicyVersion)||($.eventName=AttachRolePolicy)||($.eventName=DetachRolePolicy)||($.eventName=AttachUserPolicy)||($.eventName=DetachUserPolicy)||($.eventName=AttachGroupPolicy)||($.eventName=DetachGroupPolicy)}
        metric-namespace: CloudTrailMetrics
        metric-name: IAMPolicyEventCount
        metric-value: '1'
      - filter-name: ConsoleSignInWithoutMfaMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.eventName="ConsoleLogin") && ($.additionalEventData.MFAUsed
          !="Yes") && ($.userIdentity.type != "AssumedRole")}
        metric-namespace: CloudTrailMetrics
        metric-name: ConsoleSignInWithoutMfaCount
        metric-value: '1'
      - filter-name: RootLoginMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { $.userIdentity.type = "Root" && $.userIdentity.invokedBy NOT EXISTS
          && $.eventType != "AwsServiceEvent" }
        metric-namespace: CloudTrailMetrics
        metric-name: RootLoginEventCount
        metric-value: '1'
      - filter-name: DisableOrDeleteCMKMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.eventSource=kms.amazonaws.com) && (($.eventName=DisableKey) ||
          ($.eventName=ScheduleKeyDeletion))}
        metric-namespace: CloudTrailMetrics
        metric-name: DisableOrDeleteCMKCount
        metric-value: '1'
      - filter-name: AWSConfigChangesMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.eventSource=config.amazonaws.com) &&
          (($.eventName=StopConfigurationRecorder) ||
          ($.eventName=DeleteDeliveryChannel) ||
          ($.eventName=PutDeliveryChannel) ||
          ($.eventName=PutConfigurationRecorder))}
        metric-namespace: CloudTrailMetrics
        metric-name: AWSConfigChangesCount
        metric-value: '1'
      - filter-name: RouteTableChangesMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.eventName=CreateRoute) || ($.eventName=CreateRouteTable) ||
          ($.eventName=ReplaceRoute) ||
          ($.eventName=ReplaceRouteTableAssociation) ||
          ($.eventName=DeleteRouteTable) || ($.eventName=DeleteRoute) ||
          ($.eventName=DisassociateRouteTable)}
        metric-namespace: CloudTrailMetrics
        metric-name: RouteTableChangesCount
        metric-value: '1'
      - filter-name: S3BucketPolicyChangesMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.eventSource=s3.amazonaws.com) && (($.eventName=PutBucketAcl) ||
          ($.eventName=PutBucketPolicy) || ($.eventName=PutBucketCors) ||
          ($.eventName=PutBucketLifecycle) || ($.eventName=PutBucketReplication)
          || ($.eventName=DeleteBucketPolicy) || ($.eventName=DeleteBucketCors)
          || ($.eventName=DeleteBucketLifecycle) ||
          ($.eventName=DeleteBucketReplication))}
        metric-namespace: CloudTrailMetrics
        metric-name: S3BucketPolicyChangesCount
        metric-value: '1'
      - filter-name: SSOAuthUnapprovedIPMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventSource=sso.amazonaws.com) && ($.eventName=Authenticate) &&
          ($.sourceIPAddress != 192.197.178.2) }
        metric-namespace: CloudTrailMetrics
        metric-name: SSOAuthUnapprovedIPCount
        metric-value: '1'
      - filter-name: SSOAuthAdminMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: |-
          {
            ($.eventSource=sso.amazonaws.com)
            && ($.eventName=Federate)
            && ($.serviceEventDetails.role_name = Role-Admin)
            && ($.serviceEventDetails.account_id != 228684575133)
            && ($.serviceEventDetails.account_id != 545171450611)
            && ($.serviceEventDetails.account_id != 353339020427)
            && ($.serviceEventDetails.account_id != 997166656503)
            && ($.serviceEventDetails.account_id != 161888264973)
            && ($.serviceEventDetails.account_id != 590823595399)
            && ($.serviceEventDetails.account_id != 790963556785)
            && ($.serviceEventDetails.account_id != 876921396050)
            && ($.serviceEventDetails.account_id != 002494661505)
            && ($.serviceEventDetails.account_id != 076283806872)
            && ($.serviceEventDetails.account_id != 654703398369)
            && ($.serviceEventDetails.account_id != 387826134931)
            && ($.serviceEventDetails.account_id != 246731525552)
          }
        metric-namespace: CloudTrailMetrics
        metric-name: SSOAuthAdminCount
        metric-value: '1'
      - filter-name: SwitchRolePBMMAccelPipelineRoleMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventSource=signin.amazonaws.com) && ($.eventName=SwitchRole) &&
          ($.userIdentity.arn =
          "arn:aws:sts::*:assumed-role/PBMMAccel-PipelineRole/*") }
        metric-namespace: CloudTrailMetrics
        metric-name: SwitchRolePBMMAccelPipelineRoleCount
        metric-value: '1'
      - filter-name: IAMAuthMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: '{ ($.eventName=ConsoleLogin) && ($.userIdentity.type=IAMUser) }'
        metric-namespace: CloudTrailMetrics
        metric-name: IAMAuthCount
        metric-value: '1'
      - filter-name: UnencryptedFilesystemCreatedMetric
        accounts:
          - master
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          { ($.eventName = CreateFileSystem) && ($.responseElements.encrypted IS
          FALSE) }
        metric-namespace: CloudTrailMetrics
        metric-name: UnencryptedFilesystemCreatedCount
        metric-value: '1'
      - filter-name: IgnoreAuthorizationFailureMetric
        accounts:
          - management
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.errorCode="*UnauthorizedOperation") ||
          ($.errorCode="AccessDenied*")}
        metric-namespace: CloudTrailMetrics
        metric-name: IgnoreAuthorizationFailureCount
        metric-value: '1'
      - filter-name: IgnoreConsoleSignInWithoutMfaMetric
        accounts:
          - management
        regions:
          - ${HOME_REGION}
        loggroup-name: /${ACCELERATOR_PREFIX_ND}/CloudTrail
        filter-pattern: >-
          {($.eventName="ConsoleLogin") && ($.additionalEventData.MFAUsed
          !="Yes")}
        metric-namespace: CloudTrailMetrics
        metric-name: IgnoreConsoleSignInWithoutMfaCount
        metric-value: '1'
    alarms:
      default-accounts:
        - master
      default-regions:
        - ${HOME_REGION}
      default-namespace: CloudTrailMetrics
      default-statistic: Sum
      default-period: 300
      default-threshold-type: Static
      default-comparison-operator: GreaterThanOrEqualToThreshold
      default-threshold: 1
      default-evaluation-periods: 1
      default-treat-missing-data: notBreaching
      definitions:
        - alarm-name: AWS-Security-Group-Changed
          metric-name: SecurityGroupEventCount
          sns-alert-level: Low
          alarm-description: >-
            Alarms when one or more API calls are made to create, update or
            delete a Security Group (in any account, any region of your AWS
            Organization).
        - alarm-name: AWS-Network-ACL-Changed
          metric-name: NetworkAclEventCount
          sns-alert-level: Medium
          alarm-description: >-
            Alarms when one or more API calls are made to create, update or
            delete a Network ACL (in any account, any region of your AWS
            Organization).
        - alarm-name: AWS-Gateway-Changed
          metric-name: GatewayEventCount
          sns-alert-level: Medium
          alarm-description: >-
            Alarms when one or more API calls are made to create, update or
            delete a Customer or Internet Gateway (in any account, any region of
            your AWS Organization).
        - alarm-name: AWS-VPC-Changed
          metric-name: VpcEventCount
          sns-alert-level: Medium
          alarm-description: >-
            Alarms when one or more API calls are made to create, update or
            delete a VPC, VPC peering connection or VPC connection to classic
            (in any account, any region of your AWS Organization).
        - alarm-name: AWS-EC2-Instances-Changed
          metric-name: EC2InstanceEventCount
          sns-alert-level: Low
          alarm-description: >-
            Alarms when one or more API calls are made to create, terminate,
            start, stop or reboot any EC2 instance (in any account, any region
            of your AWS Organization).
        - alarm-name: AWS-EC2-Large-Instance-Changed
          metric-name: EC2LargeInstanceEventCount
          sns-alert-level: Medium
          alarm-description: >-
            Alarms when one or more API calls are made to create, terminate,
            start, stop or reboot a 4x, 8x, 9x, 10x, 12x, 16x, 18x, 24x,
            32x-large EC2 instance (in any account, any region of your AWS
            Organization).
        - alarm-name: AWS-CloudTrail-Changed
          metric-name: CloudTrailEventCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when one or more API calls are made to create, update or
            delete a CloudTrail trail, or to start or stop logging to a trail
            (in any account, any region of your AWS Organization).
        - alarm-name: AWS-Console-SignIn-Failure
          metric-name: ConsoleSignInFailureCount
          sns-alert-level: High
          threshold: 3
          alarm-description: >-
            Alarms when one or more unauthenticated API calls are made to sign
            into the console (in any account, any region of your AWS
            Organization).
        - alarm-name: AWS-Authorization-Failure
          metric-name: AuthorizationFailureCount
          sns-alert-level: Low
          alarm-description: >-
            Alarms when one or more unauthorized API calls are made (in any
            account, any region of your AWS Organization).
        - alarm-name: AWS-IAM-Policy-Changed
          metric-name: IAMPolicyEventCount
          sns-alert-level: Medium
          alarm-description: >-
            Alarms when one or more API calls are made to change an IAM policy
            (in any account, any region of your AWS Organization).
        - alarm-name: AWS-Console-SignIn-Without-MFA
          metric-name: ConsoleSignInWithoutMfaCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when MFA is NOT used to sign into the console with IAM (in
            any account, any region of your AWS Organization).
        - alarm-name: AWS-Root-Login
          metric-name: RootLoginEventCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when the root user successfully logs in one or more times (in
            any account, any region of your AWS Organization).
        - alarm-name: AWS-Disable-Or-Delete-KMS-CMK
          metric-name: DisableOrDeleteCMKCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when one or more Key Management Service Customer Managed Keys
            are disabled or scheduled for deletion (in any account, any region
            of your AWS Organization).
        - alarm-name: AWS-Config-Changed
          metric-name: AWSConfigChangesCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when one or more modifications are made to AWS Config
            Settings (in any account, any region of your AWS Organization).
        - alarm-name: AWS-Route-Table-Changed
          metric-name: RouteTableChangesCount
          sns-alert-level: Medium
          alarm-description: >-
            Alarms when one or more API calls are made to create, update or
            delete a Route table (in any account, any region of your AWS
            Organization).
        - alarm-name: AWS-S3-Bucket-Policy-Changed
          metric-name: S3BucketPolicyChangesCount
          sns-alert-level: Medium
          alarm-description: >-
            Alarms when one or more API calls are made to create, update or
            delete an S3 Bucket policy (in any account, any region of your AWS
            Organization).
        - alarm-name: AWS-SSO-Authentication-From-Unapproved-IP
          metric-name: SSOAuthUnapprovedIPCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when someone authenticates using AWS SSO from an unauthorized
            IP address range.
        - alarm-name: AWS-SSO-Authentication-Admin
          metric-name: SSOAuthAdminCount
          sns-alert-level: High
          alarm-description: Alarms when someone authenticates using admin role.
        - alarm-name: AWS-Switch-Role-PBMMAccel-PipelineRole
          metric-name: SwitchRolePBMMAccelPipelineRoleCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when someone switches the role using authenticates using
            PBMMAccel-PipelineRole.
        - alarm-name: AWS-IAM-Authentication
          metric-name: IAMAuthCount
          sns-alert-level: High
          alarm-description: Alarms when someone authenticates using AWS IAM.
        - alarm-name: AWS-Unencrypted-Filesystem-Created
          metric-name: UnencryptedFilesystemCreatedCount
          sns-alert-level: High
          alarm-description: >-
            Alarms when one or more API calls are made to create an Unencrypted
            filesystem (i.e. EFS) (in any account, any region of your AWS
            Organization).
        - alarm-name: IGNORE-AWS-Authorization-Failure
          metric-name: IgnoreAuthorizationFailureCount
          sns-alert-level: Ignore
          alarm-description: >-
            Alarms when one or more unauthorized API calls are made (in any
            account, any region of your AWS Organization).
        - alarm-name: IGNORE-AWS-Console-SignIn-Without-MFA
          metric-name: IgnoreConsoleSignInWithoutMfaCount
          sns-alert-level: Ignore
          alarm-description: >-
            Alarms when MFA is NOT used to sign into the console with IAM (in
            any account, any region of your AWS Organization).
      default-in-org-mgmt-use-lcl-sns: true
  ssm-automation:
    - accounts:
        - operations
      regions:
        - ${HOME_REGION}
      documents:
        - name: SSM-ELB-Enable-Logging
          description: Calls the AWS CLI to enable access logs on a specified ELB.
          template: ssm-elb-enable-logging.yaml
        - name: Put-S3-Encryption
          description: Enables S3 encryption using KMS
          template: s3-encryption.yaml
        - name: Attach-IAM-Instance-Profile
          description: Attaches instance profiles to an EC2 instance
          template: attach-iam-instance-profile.yaml
        - name: Attach-IAM-Role-Policy
          description: Attachs Aws IAM Managed Policy to IAM Role.
          template: attach-iam-role-policy.yaml
  aws-config:
    defaults:
      remediation: false
      remediation-attempts: 5
      remediation-retry-seconds: 60
      remediation-concurrency: 10
    rules:
      - name: EC2-INSTANCE-PROFILE
        type: custom
        resource-types:
          - AWS::EC2::Instance
        runtime: nodejs22.x
        remediation-action: Attach-IAM-Instance-Profile
        remediation: true
        remediation-params:
          IamInstanceProfile: EC2-Default-SSM-AD-Role-ip
          InstanceId: RESOURCE_ID
      - name: EC2-INSTANCE-PROFILE-PERMISSIONS
        type: custom
        resource-types:
          - AWS::IAM::Role
        runtime: nodejs22.x
        parameters:
          AWSManagedPolicies: >-
            AmazonSSMManagedInstanceCore, AmazonSSMDirectoryServiceAccess,
            CloudWatchAgentServerPolicy
          CustomerManagedPolicies: ${SEA::EC2InstaceProfilePermissions}
          ResourceId: RESOURCE_ID
        remediation: true
        remediation-action: Attach-IAM-Role-Policy
        remediation-params:
          AWSManagedPolicies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          CustomerManagedPolicies:
            - ${SEA::EC2InstaceProfilePermissions}
          ResourceId: RESOURCE_ID
      - name: ELB_LOGGING_ENABLED
        remediation-action: SSM-ELB-Enable-Logging
        remediation: true
        parameters:
          s3BucketNames: ${SEA::LogArchiveAesBucket}
        remediation-params:
          LoadBalancerArn: RESOURCE_ID
          LogDestination: ${SEA::LogArchiveAesBucket}
      - name: S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
        remediation-action: Put-S3-Encryption
        remediation: true
        remediation-params:
          BucketName: RESOURCE_ID
          KMSMasterKey: ${SEA::S3BucketEncryptionKey}
      - name: ACM_CERTIFICATE_EXPIRATION_CHECK
        parameters:
          daysToExpiration: '90'
      - name: ALB_WAF_ENABLED
      - name: API_GW_CACHE_ENABLED_AND_ENCRYPTED
      - name: CLOUD_TRAIL_ENABLED
      - name: CLOUDTRAIL_S3_DATAEVENTS_ENABLED
      - name: CLOUDTRAIL_SECURITY_TRAIL_ENABLED
      - name: CLOUDWATCH_ALARM_ACTION_CHECK
        parameters:
          alarmActionRequired: 'TRUE'
          insufficientDataActionRequired: 'TRUE'
          okActionRequired: 'FALSE'
      - name: CW_LOGGROUP_RETENTION_PERIOD_CHECK
      - name: DB_INSTANCE_BACKUP_ENABLED
      - name: DYNAMODB_IN_BACKUP_PLAN
      - name: DYNAMODB_TABLE_ENCRYPTED_KMS
      - name: EBS_IN_BACKUP_PLAN
      - name: EC2_INSTANCE_DETAILED_MONITORING_ENABLED
      - name: EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
      - name: EC2_VOLUME_INUSE_CHECK
        parameters:
          deleteOnTermination: 'TRUE'
      - name: ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
      - name: ELB_ACM_CERTIFICATE_REQUIRED
      - name: ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
      - name: EMR_KERBEROS_ENABLED
      - name: GUARDDUTY_NON_ARCHIVED_FINDINGS
        parameters:
          daysHighSev: '1'
          daysLowSev: '30'
          daysMediumSev: '7'
      - name: IAM_GROUP_HAS_USERS_CHECK
      - name: IAM_PASSWORD_POLICY
        parameters:
          MaxPasswordAge: '90'
          MinimumPasswordLength: '14'
          PasswordReusePrevention: '24'
          RequireLowercaseCharacters: 'TRUE'
          RequireNumbers: 'TRUE'
          RequireSymbols: 'TRUE'
          RequireUppercaseCharacters: 'TRUE'
      - name: IAM_USER_GROUP_MEMBERSHIP_CHECK
      - name: INCOMING_SSH_DISABLED
      - name: INSTANCES_IN_VPC
      - name: INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
      - name: RDS_IN_BACKUP_PLAN
      - name: REDSHIFT_CLUSTER_CONFIGURATION_CHECK
        parameters:
          clusterDbEncrypted: 'TRUE'
          loggingEnabled: 'TRUE'
      - name: RESTRICTED_INCOMING_TRAFFIC
        parameters:
          blockedPort1: '20'
          blockedPort2: '21'
          blockedPort3: '3389'
          blockedPort4: '3306'
          blockedPort5: '4333'
      - name: S3_BUCKET_POLICY_GRANTEE_CHECK
      - name: S3_BUCKET_VERSIONING_ENABLED
      - name: SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
      - name: SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
      - name: SECURITYHUB_ENABLED
      - name: VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
        parameters:
          authorizedTcpPorts: '443'
          authorizedUdpPorts: 1020-1025
      - name: WAFV2_LOGGING_ENABLED
  endpoint-port-overrides:
    athena:
      - TCP:443
      - TCP:444
    email-smtp:
      - TCP:465
      - TCP:587
mandatory-account-configs:
  shared-network:
    account-name: SharedNetwork
    email: matarneh+ic.aws-network-reseau-aws.ic@amazon.com
    ou: Infrastructure
    src-filename: config.yaml
    budget:
      name: SharedNetwork Budget
      period: Monthly
      amount: 2000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    limits:
      Amazon VPC/Interface VPC endpoints per VPC:
        value: 90
        customer-confirm-inplace: false
      Amazon VPC/VPCs per Region:
        value: 15
    vpc:
      - deploy: local
        name: Endpoint
        cidr:
          - value: 10.7.0.0/22
            size: 22
            pool: main
        region: ${HOME_REGION}
        use-central-endpoints: false
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: Endpoint
            definitions:
              - az: a
                route-table: EndpointVPC_Common
                cidr:
                  value: 10.7.0.0/24
                  pool: main
                  size: 24
              - az: b
                route-table: EndpointVPC_Common
                cidr:
                  value: 10.7.1.0/24
                  pool: main
                  size: 24
        gateway-endpoints: []
        route-tables:
          - name: EndpointVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
        security-groups:
          - name: DNS_inbound_endpoint
            inbound-rules:
              - description: Allow all DNS Inbound Traffic
                tcp-ports:
                  - 53
                udp-ports:
                  - 53
                source:
                  - 0.0.0.0/0
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: Main
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - core
          tgw-rt-propagate:
            - core
            - segregated
            - shared
            - standalone
          blackhole-route: false
          attach-subnets:
            - Endpoint
          options:
            - DNS-support
        interface-endpoints:
          subnet: Endpoint
          endpoints:
            - ec2
            - ec2messages
            - ssm
            - ssmmessages
            - secretsmanager
            - cloudformation
            - access-analyzer
            - application-autoscaling
            - appmesh-envoy-management
            - athena
            # - autoscaling
            # - autoscaling-plans
            # - clouddirectory
            # - cloudtrail
            # - codebuild
            # - codecommit
            # - codepipeline
            # - config
            # - datasync
            # - ecr.dkr
            # - ecs
            # - ecs-agent
            # - ecs-telemetry
            # - elasticfilesystem
            # - elasticloadbalancing
            # - elasticmapreduce
            # - events
            # - execute-api
            # - git-codecommit
            # - glue
            # - kinesis-streams
            # - kms
            # - logs
            # - monitoring
            # - sagemaker.api
            # - sagemaker.runtime
            # - servicecatalog
            # - sms
            # - sns
            # - sqs
            # - storagegateway
            # - sts
            # - transfer
            # - workspaces
            # - awsconnector
            # - ecr.api
            # - kinesis-firehose
            # - states
            # - acm-pca
            # - cassandra
            # - ebs
            # - elasticbeanstalk
            # - elasticbeanstalk-health
            # - email-smtp
            # - license-manager
            # - macie2
            # - notebook
            # - synthetics
            # - transfer.server
        resolvers:
          subnet: Endpoint
          outbound: true
          inbound: true
        on-premise-rules:
          - zone: prod.prv
            outbound-ips:
              - 1.1.1.1
              - 1.1.1.2
          - zone: pre-prod.prv
            outbound-ips:
              - 1.1.1.3
              - 1.1.1.4
          - zone: ic.example.local
            outbound-ips:
              - 1.1.1.1
              - 1.1.1.2
          - zone: 033gc.example.local
            outbound-ips:
              - 1.1.1.1
              - 1.1.1.2
          - zone: cloud-nuage.example.gc.ca
            outbound-ips:
              - 1.1.1.1
              - 1.1.1.2
        zones:
          public:
            - testised-isde.canada.ca
            - testmras.ca
            - testcanadasbusinessregistries.ca
            - testregistresdentreprisesaucanada.ca
          private:
            - aws.033gc.example.gc.ca
        central-endpoint: true
        description: >-
          This VPC is used to host AWS Service Endpoints, making AWS services
          available using private address space.
        cidr-src: provided
      - deploy: local
        name: UsEast1Endpoint
        cidr:
          - value: 10.8.0.0/22
            size: 22
            pool: main
        region: us-east-1
        use-central-endpoints: false
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: UsEast1Endpoint
            definitions:
              - az: a
                route-table: UsEast1EndpointVPC_Common
                cidr:
                  value: 10.8.0.0/24
                  pool: main
                  size: 24
              - az: b
                route-table: UsEast1EndpointVPC_Common
                cidr:
                  value: 10.8.1.0/24
                  pool: main
                  size: 24
        gateway-endpoints: []
        route-tables:
          - name: UsEast1EndpointVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
        security-groups:
          - name: DNS_inbound_endpoint
            inbound-rules:
              - description: Allow all DNS Inbound Traffic
                tcp-ports:
                  - 53
                udp-ports:
                  - 53
                source:
                  - 0.0.0.0/0
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: UsEast1
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - core
          tgw-rt-propagate:
            - core
            - segregated
            - shared
            - standalone
          blackhole-route: false
          attach-subnets:
            - UsEast1Endpoint
          options:
            - DNS-support
        interface-endpoints:
          subnet: UsEast1Endpoint
          endpoints:
            - ec2
            - ec2messages
            - ssm
            - ssmmessages
            - secretsmanager
            - cloudformation
            - access-analyzer
            - application-autoscaling
            - appmesh-envoy-management
            - athena
            # - autoscaling
            # - autoscaling-plans
            # - clouddirectory
            # - cloudtrail
            # - codebuild
            # - codecommit
            # - codepipeline
            # - config
            # - datasync
            # - ecr.dkr
            # - ecs
            # - ecs-agent
            # - ecs-telemetry
            # - elasticfilesystem
            # - elasticloadbalancing
            # - elasticmapreduce
            # - events
            # - execute-api
            # - git-codecommit
            # - glue
            # - kinesis-streams
            # - kms
            # - logs
            # - monitoring
            # - sagemaker.api
            # - sagemaker.runtime
            # - servicecatalog
            # - sms
            # - sns
            # - sqs
            # - storagegateway
            # - sts
            # - workspaces
            # - awsconnector
            # - ecr.api
            # - kinesis-firehose
            # - states
            # - acm-pca
            # - cassandra
            # - ebs
            # - elasticbeanstalk
            # - elasticbeanstalk-health
            # - email-smtp
            # - license-manager
            # - macie2
            # - notebook
            # - synthetics
        resolvers:
          subnet: UsEast1Endpoint
          outbound: true
          inbound: true
        on-premise-rules:
          - zone: prod.prv
            outbound-ips:
              - 142.53.104.34
              - 142.53.104.90
          - zone: pre-prod.prv
            outbound-ips:
              - 142.53.204.83
              - 142.53.204.84
          - zone: ic.gc.ca
            outbound-ips:
              - 142.53.104.34
              - 142.53.104.90
          - zone: 033gc.gc.ca
            outbound-ips:
              - 142.53.104.34
              - 142.53.104.90
        central-endpoint: true
        description: >-
          This VPC is used to host AWS Service Endpoints, making AWS services
          available using private address space.
        cidr-src: provided
    deployments:
      tgw:
        - name: Main
          asn: 65102
          region: ${HOME_REGION}
          features:
            DNS-support: true
            VPN-ECMP-support: true
            Default-route-table-association: false
            Default-route-table-propagation: false
            Auto-accept-sharing-attachments: true
          route-tables:
            - core
            - segregated
            - shared
            - standalone
          tgw-routes:
            - name: '{TGW_ALL}'
              routes:
                - destination: 10.6.0.0/16
                  target-tgw: UsEast1
        - name: UsEast1
          asn: 65104
          region: us-east-1
          features:
            DNS-support: true
            VPN-ECMP-support: true
            Default-route-table-association: false
            Default-route-table-propagation: false
            Auto-accept-sharing-attachments: true
          route-tables:
            - core
            - segregated
            - shared
            - standalone
          tgw-attach:
            associate-to-tgw: Main
            account: shared-network
            region: ${HOME_REGION}
            tgw-rt-associate-local:
              - core
            tgw-rt-associate-remote:
              - segregated
          tgw-routes:
            - name: '{TGW_ALL}'
              routes:
                - destination: 0.0.0.0/0
                  target-tgw: Main
    description: This Account is used for centralized or shared networking resources.
  operations:
    account-name: Operations
    email: matarneh+ic.aws-operations-operations-aws.ic@amazon.com
    ou: Infrastructure
    account-warming-required: true
    limits: {}
    src-filename: config.yaml
    certificates:
      - name: Operations-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
    alb:
      - name: Core
        scheme: internal
        action-type: forward
        ip-type: ipv4
        listeners: HTTPS
        ports: 443
        vpc: Central
        subnets: Web
        cert-name: Operations-EntrustCert
        security-policy: ELBSecurityPolicy-FS-1-2-Res-2019-08
        security-group: Web
        access-logs: true
        targets:
          - target-name: health-check-Lambda
            target-type: lambda
            health-check-path: /health-check
            lambda-filename: internal-test-alb-lambda.txt
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
        - policy-name: ${ACCELERATOR_PREFIX_ND}-RDGW-Custom-Policy
          policy: rdgw-custom-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
        - role: ${ACCELERATOR_PREFIX_ND}-RDGW-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
            - ${ACCELERATOR_PREFIX_ND}-RDGW-Custom-Policy
          boundary-policy: Default-Boundary-Policy
        - role: ${ACCELERATOR_PREFIX_ND}-Rsyslog-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - CloudWatchAgentServerPolicy
            - AmazonS3ReadOnlyAccess
            - AmazonSSMDirectoryServiceAccess
          boundary-policy: Default-Boundary-Policy
    deployments:
      rsyslog:
        deploy: false
        vpc-name: Central
        region: ${HOME_REGION}
        log-group-name: rsyslog/var/log/messages
        rsyslog-enforce-imdsv2: false
        security-groups:
          - name: rsyslog
            inbound-rules:
              - description: Allow Traffic Inbound
                tcp-ports:
                  - 514
                udp-ports:
                  - 514
                source:
                  - 10.0.0.0/8
                  - 100.96.192.0/23
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        app-subnets:
          - name: App
            az: a
          - name: App
            az: b
        web-subnets:
          - name: Web
            az: a
          - name: Web
            az: b
        min-rsyslog-hosts: 1
        desired-rsyslog-hosts: 2
        max-rsyslog-hosts: 2
        ssm-image-id: /aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2
        rsyslog-instance-type: t3.large
        rsyslog-instance-role: ${ACCELERATOR_PREFIX_ND}-Rsyslog-Role
        rsyslog-root-volume-size: 500
        rsyslog-max-instance-age: 30
    description: >-
      This Account is used for centralized IT Operational resources ( rsyslog,
      ITSM, etc.).
  perimeter:
    account-name: Perimeter
    email: matarneh+ic.aws-perimeter-perimetre-aws.ic@amazon.com
    ou: Infrastructure
    account-warming-required: true
    src-filename: config.yaml
    populate-all-elbs-in-param-store: true
    limits:
      Amazon EC2/Number of EIPs:
        value: 5
        customer-confirm-inplace: false
    budget:
      name: Perimeter Budget
      period: Monthly
      amount: 2000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    certificates:
      - name: Perimeter-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
        - policy-name: Firewall-Policy
          policy: firewall-fg-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
        - role: Firewall-Role
          type: ec2
          policies:
            - Firewall-Policy
            - AmazonSSMDirectoryServiceAccess
            - AmazonSSMManagedInstanceCore
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    vpc:
      - deploy: local
        name: Perimeter
        cidr:
          - value: 10.7.4.0/22
            size: 22
            pool: main
          - value: 100.96.192.0/23
            pool: RFC6598b
            size: 23
          - value: 10.63.0.0/16
            size: 16
            pool: mgmt
        region: ${HOME_REGION}
        use-central-endpoints: false
        flow-logs: CWL
        dns-resolver-logging: true
        igw: true
        vgw:
          asn: 65103
        subnets:
          - name: Public
            definitions:
              - az: a
                route-table: Public_Shared1
                cidr:
                  value: 100.96.192.0/26
                  pool: RFC6598b
                  size: 26
              - az: b
                route-table: Public_Shared1
                cidr:
                  value: 100.96.192.128/26
                  pool: RFC6598b
                  size: 26
          - name: FWMgmt
            definitions:
              - az: a
                route-table: FWMgmt_azA1
                cidr:
                  value: 100.96.193.32/27
                  pool: RFC6598b
                  size: 27
              - az: b
                route-table: FWMgmt_azB1
                cidr:
                  value: 100.96.193.160/27
                  pool: RFC6598b
                  size: 27
          - name: Proxy
            definitions:
              - az: a
                route-table: Proxy_azA1
                cidr:
                  value: 100.96.193.64/26
                  pool: RFC6598b
                  size: 26
              - az: b
                route-table: Proxy_azB1
                cidr:
                  value: 100.96.193.192/26
                  pool: RFC6598b
                  size: 26
          - name: OnPremise
            definitions:
              - az: a
                route-table: OnPremise_azA1
                cidr:
                  value: 100.96.192.64/26
                  pool: RFC6598b
                  size: 26
              - az: b
                route-table: OnPremise_azB1
                cidr:
                  value: 100.96.192.192/26
                  pool: RFC6598b
                  size: 26
          - name: Detonation
            definitions:
              - az: a
                route-table: Detonation_Shared1
                cidr:
                  value: 10.7.4.0/24
                  pool: main
                  size: 24
              - az: b
                route-table: Detonation_Shared1
                cidr:
                  value: 10.7.5.0/24
                  pool: main
                  size: 24
          - name: ISEDMgmt
            definitions:
              - az: a
                route-table: ISEDMgmt_azA1
                cidr:
                  value: 10.63.0.0/28
                  pool: mgmt
                  size: 28
              - az: b
                route-table: ISEDMgmt_azB1
                cidr:
                  value: 10.63.0.128/28
                  pool: mgmt
                  size: 28
        gateway-endpoints:
          - s3
        route-tables:
          - name: OnPremise_azA1
            routes:
              - destination: 10.0.0.0/8
                target: firewall
                name: Firewall-AWS_Internal
                az: a
                port: OnPremise
              - destination: 0.0.0.0/0
                target: VGW
              - destination: 142.53.207.121/32
                target: firewall
                name: Firewall-A-OnPrem
                az: a
                port: OnPremise
          - name: OnPremise_azB1
            routes:
              - destination: 10.0.0.0/8
                target: firewall
                name: Firewall-AWS_Internal
                az: b
                port: OnPremise
              - destination: 0.0.0.0/0
                target: VGW
              - destination: 142.53.207.121/32
                target: firewall
                name: Firewall-B-OnPrem
                az: b
                port: OnPremise
          - name: Public_Shared1
            routes:
              - destination: 0.0.0.0/0
                target: IGW
          - name: FWMgmt_azA1
            routes:
              - destination: 0.0.0.0/0
                target: VGW
              - destination: 10.1.0.0/16
                target: firewall
                name: Firewall-AWS_OpsInternal
                az: a
                port: OnPremise
              - destination: s3
                target: s3
          - name: FWMgmt_azB1
            routes:
              - destination: 0.0.0.0/0
                target: VGW
              - destination: 10.1.0.0/16
                target: firewall
                name: Firewall-AWS_OpsInternal
                az: b
                port: OnPremise
              - destination: s3
                target: s3
          - name: Proxy_azA1
            routes:
              - destination: 0.0.0.0/0
                target: firewall
                name: Firewall
                az: a
                port: Proxy
          - name: Proxy_azB1
            routes:
              - destination: 0.0.0.0/0
                target: firewall
                name: Firewall
                az: b
                port: Proxy
          - name: Detonation_Shared1
        security-groups:
          - name: FortiWebs
            inbound-rules:
              - description: Allow all HTTP Inbound Traffic
                tcp-ports:
                  - 80
                source:
                  - 0.0.0.0/0
              - description: Allow all HTTPS Inbound Traffic
                tcp-ports:
                  - 443
                source:
                  - 0.0.0.0/0
              - description: Allow all HealthCheck Inbound Traffic
                tcp-ports:
                  - 8008
                source:
                  - 0.0.0.0/0
              - description: Allow all 8080 Inbound Traffic
                tcp-ports:
                  - 8080
                source:
                  - 0.0.0.0/0
              - description: Allow all 8333 Inbound Traffic
                tcp-ports:
                  - 8333
                source:
                  - 0.0.0.0/0
              - description: Allow all mgmt interface Inbound Traffic
                tcp-ports:
                  - 8443
                source:
                  - 0.0.0.0/0
              - description: Allow all OCP Web 6443 traffic
                tcp-ports:
                  - 6443
                source:
                  - 0.0.0.0/0
              - description: Allow all HA heartbeat traffic
                udp-ports:
                  - 6055
                  - 6056
                source:
                  - 100.96.192.0/23
              - description: Allow all Config Replication traffic
                tcp-ports:
                  - 995
                  - 6010
                  - 8333
                source:
                  - 100.96.192.0/23
              - description: Allow all Syslog traffic
                udp-ports:
                  - 514
                source:
                  - 100.96.192.0/23
              - description: SSH from local net
                tcp-ports:
                  - 22
                source:
                  - 100.96.192.0/23
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: FortiAnalyzers
            inbound-rules:
              - description: Allow all HTTP Inbound Traffic
                tcp-ports:
                  - 80
                source:
                  - 0.0.0.0/0
              - description: Allow all HTTPS Inbound Traffic
                tcp-ports:
                  - 443
                source:
                  - 0.0.0.0/0
              - description: Allow all HealthCheck Inbound Traffic
                tcp-ports:
                  - 8008
                source:
                  - 0.0.0.0/0
              - description: Allow all 8080 Inbound Traffic
                tcp-ports:
                  - 8080
                source:
                  - 0.0.0.0/0
              - description: Allow all 8333 Inbound Traffic
                tcp-ports:
                  - 8333
                source:
                  - 0.0.0.0/0
              - description: Allow all mgmt interface Inbound Traffic
                tcp-ports:
                  - 8443
                source:
                  - 0.0.0.0/0
              - description: Allow all OCP Web 6443 traffic
                tcp-ports:
                  - 6443
                source:
                  - 0.0.0.0/0
              - description: Allow all HA heartbeat traffic
                udp-ports:
                  - 6055
                  - 6056
                source:
                  - 100.96.192.0/23
              - description: Allow all Config Replication traffic
                tcp-ports:
                  - 995
                  - 6010
                  - 8333
                source:
                  - 100.96.192.0/23
              - description: Allow all Syslog traffic
                udp-ports:
                  - 514
                source:
                  - 100.96.192.0/23
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Public-ALB-sg
            inbound-rules:
              - description: TLS Traffic Inbound
                tcp-ports:
                  - 80
                  - 443
                source:
                  - 0.0.0.0/0
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Ised-ALB-sg
            inbound-rules:
              - description: TLS Traffic Inbound
                tcp-ports:
                  - 80
                  - 443
                source:
                  - 192.197.178.2/32
            outbound-rules:
              - description: All Outbound
                tcp-ports:
                  - 80
                  - 443
                source:
                  - 0.0.0.0/0
          - name: FirewallMgr
            inbound-rules:
              - description: FortiGate_azA allow
                type:
                  - ALL
                source:
                  - 100.96.193.51/32
              - description: FortiGate_azB allow
                type:
                  - ALL
                source:
                  - 100.96.193.187/32
              - description: FortiWeb_azA allow
                type:
                  - ALL
                source:
                  - 100.96.192.100/32
              - description: FortiWeb_azB allow
                type:
                  - ALL
                source:
                  - 100.96.192.200/32
              - description: Syslog traffic
                tcp-ports:
                  - 514
                source:
                  - 10.0.0.0/8
              - description: Logging (OFTP-Odette File Transfer Protocol)
                tcp-ports:
                  - 541
                source:
                  - 10.0.0.0/8
              - description: Web Service (SOAP/XML API)
                tcp-ports:
                  - 8080
                source:
                  - 10.1.0.0/16
              - description: SSH from Operations
                tcp-ports:
                  - 22
                source:
                  - 10.1.0.0/16
              - description: CLI Dashboard widget
                tcp-ports:
                  - 2032
                source:
                  - 10.0.0.0/8
              - description: Allow Web Mgmt Traffic Inbound
                tcp-ports:
                  - 443
                source:
                  - 192.197.178.2/32
              - description: Web Mgmt from Operations
                tcp-ports:
                  - 443
                source:
                  - 10.1.0.0/16
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Firewalls
            inbound-rules:
              - description: >-
                  VIP ports opened to the world since OCP NLB is setup to
                  preserve client IP for downstream whitelisting
                type:
                  - TCP
                fromPort: 7000
                toPort: 7100
                source:
                  - 0.0.0.0/0
              - description: Allow all HTTPS Inbound Traffic
                tcp-ports:
                  - 443
                source:
                  - 0.0.0.0/0
              - description: Allow all 8080 Inbound Traffic
                tcp-ports:
                  - 8080
                source:
                  - 0.0.0.0/0
              - description: Mgmt Traffic, Customer Outbound traffic and ALBs
                type:
                  - ALL
                source:
                  - 10.0.0.0/8
              - description: Allow Health Traffic to Backend ALBs
                tcp-ports:
                  - 8008
                source:
                  - 100.96.192.0/23
              - description: Allow Firewall Syslog traffic
                tcp-ports:
                  - 514
                udp-ports:
                  - 514
                source:
                  - 100.96.192.0/23
              - description: Allow NAT-Traversal to GC-TIP CE1
                udp-ports:
                  - 4500
                source:
                  - 169.254.225.13/32
              - description: Allow NAT-Traversal to GC-TIP CE2
                udp-ports:
                  - 4500
                source:
                  - 169.254.226.13/32
              - description: Allow ESP to GC-TIP CE1
                udp-ports:
                  - 500
                source:
                  - 169.254.225.13/32
              - description: Allow ESP to GC-TIP CE2
                udp-ports:
                  - 500
                source:
                  - 169.254.226.13/32
              - description: For Firewall Probe
                type:
                  - TCP
                fromPort: 0
                toPort: 65535
                source:
                  - 100.96.192.0/23
              - description: Allow ping for GC-TIP CE1
                type:
                  - ICMP
                fromPort: 8
                toPort: -1
                source:
                  - 169.254.225.13/32
              - description: Allow ping for GC-TIP CE2
                type:
                  - ICMP
                fromPort: 8
                toPort: -1
                source:
                  - 169.254.226.13/32
              - description: Allow ICMP for diag in RFC6598 Net
                type:
                  - ICMP
                fromPort: 8
                toPort: -1
                source:
                  - 100.96.192.0/23
              - description: Allow ping for GC-TIP CE1
                type:
                  - ICMP
                fromPort: -1
                toPort: -1
                source:
                  - 169.254.225.13/32
              - description: Allow ping for GC-TIP CE2
                type:
                  - ICMP
                fromPort: -1
                toPort: -1
                source:
                  - 169.254.226.13/32
              - description: Allow ICMP for diag in RFC6598 Net
                type:
                  - ICMP
                fromPort: -1
                toPort: -1
                source:
                  - 100.96.192.0/23
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        interface-endpoints:
          subnet: Proxy
          endpoints:
            - ssm
            - ssmmessages
            - ec2messages
        description: >-
          This VPC is used to hold centralized ingress/egress (perimeter)
          security services.
        alb-forwarding: true
        cidr-src: provided
    deployments:
    #   firewalls:
    #     - name: Firewall
    #       image-id: ami-047aac44951feb9fb
    #       instance-sizes: c5n.xlarge
    #       region: ${HOME_REGION}
    #       security-group: Firewalls
    #       fw-instance-role: Firewall-Role
    #       vpc: Perimeter
    #       ports:
    #         - name: Public
    #           subnet: Public
    #           create-eip: true
    #           create-cgw: true
    #         - name: OnPremise
    #           subnet: OnPremise
    #           create-eip: false
    #           create-cgw: false
    #         - name: FWMgmt
    #           subnet: FWMgmt
    #           create-eip: false
    #           create-cgw: false
    #         - name: Proxy
    #           subnet: Proxy
    #           create-eip: false
    #           create-cgw: false
    #       license:
    #         - firewall/FGVM4VTM20002543.lic
    #         - firewall/FGVM4VTM20002544.lic
    #       config: firewall/firewall-example.txt
    #       fw-cgw-name: Perimeter_fw
    #       fw-cgw-asn: 64513
    #       fw-cgw-routing: Dynamic
    #       tgw-attach:
    #         associate-to-tgw: Main
    #         account: shared-network
    #         name: TGW-to-Perimeter
    #         associate-type: VPN
    #         tgw-rt-associate:
    #           - core
    #         tgw-rt-propagate:
    #           - core
    #           - segregated
    #           - shared
    #           - standalone
    #         blackhole-route: false
    #         attach-subnets: []
    #         options:
    #           - DNS-support
    #       block-device-mappings:
    #           - /dev/sda1
    #           - /dev/sdb
    #   firewall-manager:
    #     name: FirewallMgr
    #     image-id: ami-063f71d818a622e38
    #     instance-sizes: m5.large
    #     version: 7.0.2
    #     region: ${HOME_REGION}
    #     vpc: Perimeter
    #     security-group: FirewallMgr
    #     subnet:
    #       name: FWMgmt
    #       az: a
    #     create-eip: false
    #     block-device-mappings:
    #       - /dev/sda1
    #       - /dev/sdb
    # description: This Account is used for internet facing ingress/egress security services.
  master:
    account-name: AWS-ISED-CASE1311
    email: matarneh+asea-ised@amazon.com
    ou: Security
    src-filename: config.yaml
    budget:
      name: Organization Budget
      period: Monthly
      amount: 10000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    s3-retention: 180
    limits: {}
    iam:
      users:
        - user-ids:
            - bgUser1
            - bgUser2
          group: BreakGlassAdmins
          policies:
            - AdministratorAccess
          boundary-policy: Default-Boundary-Policy
        - user-ids:
            - OpsUser1
            - OpsUser2
          group: OpsAdmins
          policies:
            - AdministratorAccess
          boundary-policy: Default-Boundary-Policy
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles: []
    vpc:
      - deploy: local
        name: ForSSO
        cidr:
          - value: 10.249.1.0/24
            size: 24
            pool: ForSSO
        region: ${HOME_REGION}
        use-central-endpoints: false
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: ForSSO
            definitions:
              - az: a
                route-table: ForSSO_Shared
                cidr:
                  value: 10.249.1.0/27
                  pool: ForSSO
                  size: 27
              - az: b
                route-table: ForSSO_Shared
                cidr:
                  value: 10.249.1.32/27
                  pool: ForSSO
                  size: 27
        gateway-endpoints: []
        route-tables:
          - name: ForSSO_Shared
            routes:
              - destination:
                  account: shared-network
                  vpc: Central
                  subnet: GCWide
                target: pcx
        cidr-src: provided
    deployments:
      adc:
        deploy: false
        vpc-name: ForSSO
        subnet: ForSSO
        size: Small
        restrict_srcips:
          - 10.249.1.0/24
        connect-account-key: operations
        connect-dir-id: 1001
    ou-path: Security
  log-archive:
    account-name: log-archive
    ou: Security
    email: matarneh+ic.aws-log-journal-aws.ic@amazon.com
    src-filename: config.yaml
    description: >-
      This Account is used to centralized and store immutable logs for the
      Organization.
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
  security:
    account-name: security
    ou: Security
    email: matarneh+ic.aws-security-securite-aws.ic@amazon.com
    src-filename: config.yaml
    description: >-
      This Account is used to centralized access to AWS security tooling and
      consoles.
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
workload-account-configs:
  Prod:
    account-name: Prod
    email: matarneh+ic.aws-prod-prod-aws.ic@amazon.com
    ou: Prod
    src-filename: config.yaml
organizational-units:
  Security:
    type: ignore
    scps:
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
      - Guardrails-Part-0-Core
    default-budgets:
      name: Default Infrastructure Budget
      period: Monthly
      amount: 1000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: >-
      The infrastructure OU is used to hold AWS accounts containing AWS
      infrastructure resources shared or utilized by the rest of the
      Organization.
  Central:
    type: mandatory
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
    default-budgets:
      name: Default Central Budget
      period: Monthly
      amount: 500
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    vpc:
      - deploy: shared-network
        name: Central
        cidr:
          - value: 10.1.0.0/16
            size: 16
            pool: main
          - value: 100.96.194.0/23
            pool: RFC6598a
            size: 23
        region: ${HOME_REGION}
        use-central-endpoints: true
        flow-logs: CWL
        dns-resolver-logging: true
        pcx:
          source: master
          source-vpc: ForSSO
          source-subnets: ForSSO
          local-subnets: GCWide
        subnets:
          - name: TGW
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.88.0/27
                  pool: main
                  size: 27
              - az: b
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.88.32/27
                  pool: main
                  size: 27
              - az: d
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.88.64/27
                  pool: main
                  size: 27
                disabled: true
          - name: Web
            share-to-ou-accounts: true
            share-to-specific-accounts:
              - operations
            definitions:
              - az: a
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.32.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.128.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.192.0/20
                  pool: main
                  size: 20
                disabled: true
          - name: App
            share-to-ou-accounts: true
            share-to-specific-accounts:
              - operations
            definitions:
              - az: a
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.0.0/19
                  pool: main
                  size: 19
              - az: b
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.96.0/19
                  pool: main
                  size: 19
              - az: d
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.160.0/19
                  pool: main
                  size: 19
                disabled: true
          - name: Data
            share-to-ou-accounts: true
            share-to-specific-accounts:
              - operations
            definitions:
              - az: a
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.48.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.144.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.208.0/20
                  pool: main
                  size: 20
                disabled: true
            nacls:
              - rule: 100
                protocol: -1
                ports: -1
                rule-action: deny
                egress: true
                cidr-blocks:
                  - vpc: Central
                    subnet:
                      - Web
              - rule: 32000
                protocol: -1
                ports: -1
                rule-action: allow
                egress: true
                cidr-blocks:
                  - 0.0.0.0/0
              - rule: 100
                protocol: -1
                ports: -1
                rule-action: deny
                egress: false
                cidr-blocks:
                  - vpc: Central
                    subnet:
                      - Web
              - rule: 32000
                protocol: -1
                ports: -1
                rule-action: allow
                egress: false
                cidr-blocks:
                  - 0.0.0.0/0
          - name: Mgmt
            share-to-ou-accounts: false
            share-to-specific-accounts:
              - operations
            definitions:
              - az: a
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.64.0/21
                  pool: main
                  size: 21
              - az: b
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.72.0/21
                  pool: main
                  size: 21
              - az: d
                route-table: CentralVPC_Common
                cidr:
                  value: 10.1.80.0/21
                  pool: main
                  size: 21
                disabled: true
          - name: GCWide
            share-to-ou-accounts: false
            share-to-specific-accounts:
              - operations
            definitions:
              - az: a
                route-table: CentralVPC_GCWide
                cidr:
                  value: 100.96.194.0/25
                  pool: RFC6598a
                  size: 25
              - az: b
                route-table: CentralVPC_GCWide
                cidr:
                  value: 100.96.194.128/25
                  pool: RFC6598a
                  size: 25
              - az: d
                route-table: CentralVPC_GCWide
                cidr:
                  value: 100.96.195.0/25
                  pool: RFC6598a
                  size: 25
                disabled: true
        gateway-endpoints:
          - s3
          - dynamodb
        route-tables:
          - name: CentralVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
          - name: CentralVPC_GCWide
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
              - destination:
                  account: master
                  vpc: ForSSO
                  subnet: ForSSO
                target: pcx
        security-groups:
          - name: Mgmt
            inbound-rules:
              - description: Mgmt RDP/SSH Traffic Inbound
                type:
                  - RDP
                  - SSH
                source:
                  - 10.0.0.0/8
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Web
            inbound-rules:
              - description: World Web Traffic Inbound
                type:
                  - HTTP
                  - HTTPS
                source:
                  - 0.0.0.0/0
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: App
            inbound-rules:
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local Web Tier Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Web
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - App
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Data
            inbound-rules:
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local App DB Traffic Inbound
                type:
                  - MSSQL
                  - MYSQL/AURORA
                  - REDSHIFT
                  - POSTGRESQL
                  - ORACLE-RDS
                source:
                  - security-group:
                      - App
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Data
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: Main
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - shared
          tgw-rt-propagate:
            - core
            - shared
            - segregated
          blackhole-route: false
          attach-subnets:
            - TGW
          options:
            - DNS-support
        description: >-
          This VPC is deployed in the shared network account and it's subnets
          are shared out to the Operations account and every account in the
          Central OU.
        cidr-src: provided
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: >-
      The Central OU is used to hold AWS accounts which contain group or team
      resources used across OU boundaries like code promotion tools.
  Dev:
    type: workload
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
    default-budgets:
      name: Default Dev Budget
      period: Monthly
      amount: 2000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    certificates:
      - name: Dev-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
      - name: Test-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
      - name: Uat-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
    alb:
      - name: Core
        scheme: internal
        action-type: forward
        ip-type: ipv4
        listeners: HTTPS
        ports: 443
        vpc: Dev
        subnets: Web
        cert-name: Dev-EntrustCert
        security-policy: ELBSecurityPolicy-FS-1-2-Res-2019-08
        security-group: Web
        access-logs: true
        targets:
          - target-name: health-check-Lambda
            target-type: lambda
            health-check-path: /health-check
            lambda-filename: internal-dev-alb-lambda.txt
    vpc:
      - deploy: shared-network
        name: Dev
        cidr:
          - value: 10.2.0.0/16
            size: 16
            pool: main
          - value: 10.12.0.0/16
            size: 16
            pool: secondary
        region: ${HOME_REGION}
        use-central-endpoints: true
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: TGW
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.88.0/27
                  pool: main
                  size: 27
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.88.32/27
                  pool: main
                  size: 27
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.88.64/27
                  pool: main
                  size: 27
          - name: Web
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.32.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.128.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.192.0/20
                  pool: main
                  size: 20
          - name: App
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.0.0/19
                  pool: main
                  size: 19
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.96.0/19
                  pool: main
                  size: 19
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.160.0/19
                  pool: main
                  size: 19
          - name: Data
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.48.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.144.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.208.0/20
                  pool: main
                  size: 20
            nacls:
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: true
                cidr-blocks:
                  - vpc: Dev
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: true
                cidr-blocks:
                  - 0.0.0.0/0
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: false
                cidr-blocks:
                  - vpc: Dev
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: false
                cidr-blocks:
                  - 0.0.0.0/0
          - name: Mgmt
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.64.0/21
                  pool: main
                  size: 21
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.72.0/21
                  pool: main
                  size: 21
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.2.80.0/21
                  pool: main
                  size: 21
          - name: Rosa
            share-to-ou-accounts: false
            share-to-specific-accounts:
              - DevRosa
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.0.0/22
                  pool: main
                  size: 22
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.4.0/22
                  pool: main
                  size: 22
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.8.0/22
                  pool: main
                  size: 22
          - name: Database
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.16.0/22
                  pool: secondary
                  size: 22
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.20.0/22
                  pool: secondary
                  size: 22
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.24.0/22
                  pool: secondary
                  size: 22
          - name: RosaControllers
            share-to-ou-accounts: false
            share-to-specific-accounts:
              - DevRosa
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.12.0/26
                  pool: main
                  size: 26
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.12.64/26
                  pool: main
                  size: 26
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.12.12.128/26
                  pool: main
                  size: 26
        gateway-endpoints:
          - s3
          - dynamodb
        route-tables:
          - name: DevVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
        security-groups:
          - name: Mgmt
            inbound-rules:
              - description: Mgmt RDP/SSH Traffic Inbound
                type:
                  - RDP
                  - SSH
                source:
                  - 10.0.0.0/8
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Web
            inbound-rules:
              - description: World Web Traffic Inbound
                type:
                  - HTTP
                  - HTTPS
                source:
                  - 0.0.0.0/0
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: SC2G HealthCheck Inbound
                tcp-ports:
                  - 8008
                source:
                  - 169.254.24.170/32
                  - 169.254.148.70/32
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: App
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local Web Tier Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Web
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - App
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Data
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local App DB Traffic Inbound
                type:
                  - MSSQL
                  - MYSQL/AURORA
                  - REDSHIFT
                  - POSTGRESQL
                  - ORACLE-RDS
                source:
                  - security-group:
                      - App
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Data
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: Main
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - segregated
          tgw-rt-propagate:
            - core
            - shared
          blackhole-route: true
          attach-subnets:
            - TGW
          options:
            - DNS-support
        description: The Dev vpc in the Dev OU.
        cidr-src: provided
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-inventory-collection: true
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: The Dev OU.
  Test:
    type: workload
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
    default-budgets:
      name: Default Test Budget
      period: Monthly
      amount: 1000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    certificates:
      - name: Dev-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
      - name: Test-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
      - name: Uat-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
    alb:
      - name: Core
        scheme: internal
        action-type: forward
        ip-type: ipv4
        listeners: HTTPS
        ports: 443
        vpc: Test
        subnets: Web
        cert-name: Test-EntrustCert
        security-policy: ELBSecurityPolicy-FS-1-2-Res-2019-08
        security-group: Web
        access-logs: true
        targets:
          - target-name: health-check-Lambda
            target-type: lambda
            health-check-path: /health-check
            lambda-filename: internal-test-alb-lambda.txt
    vpc:
      - deploy: shared-network
        name: Test
        cidr:
          - value: 10.3.0.0/16
            size: 16
            pool: main
        region: ${HOME_REGION}
        use-central-endpoints: true
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: TGW
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.88.0/27
                  pool: main
                  size: 27
              - az: b
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.88.32/27
                  pool: main
                  size: 27
              - az: d
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.88.64/27
                  pool: main
                  size: 27
          - name: Web
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.32.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.128.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.192.0/20
                  pool: main
                  size: 20
                disabled: true
          - name: App
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.0.0/19
                  pool: main
                  size: 19
              - az: b
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.96.0/19
                  pool: main
                  size: 19
              - az: d
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.160.0/19
                  pool: main
                  size: 19
          - name: Data
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.48.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.144.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.208.0/20
                  pool: main
                  size: 20
            nacls:
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: true
                cidr-blocks:
                  - vpc: Test
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: true
                cidr-blocks:
                  - 0.0.0.0/0
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: false
                cidr-blocks:
                  - vpc: Test
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: false
                cidr-blocks:
                  - 0.0.0.0/0
          - name: Mgmt
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.64.0/21
                  pool: main
                  size: 21
              - az: b
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.72.0/21
                  pool: main
                  size: 21
              - az: d
                route-table: TestVPC_Common
                cidr:
                  value: 10.3.80.0/21
                  pool: main
                  size: 21
        gateway-endpoints:
          - s3
          - dynamodb
        route-tables:
          - name: TestVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
        security-groups:
          - name: Mgmt
            inbound-rules:
              - description: Mgmt RDP/SSH Traffic Inbound
                type:
                  - RDP
                  - SSH
                source:
                  - 10.0.0.0/8
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Web
            inbound-rules:
              - description: World Web Traffic Inbound
                type:
                  - HTTP
                  - HTTPS
                source:
                  - 0.0.0.0/0
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: SC2G HealthCheck Inbound
                tcp-ports:
                  - 8008
                source:
                  - 169.254.24.170/32
                  - 169.254.148.70/32
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: App
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local Web Tier Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Web
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - App
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Data
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local App DB Traffic Inbound
                type:
                  - MSSQL
                  - MYSQL/AURORA
                  - REDSHIFT
                  - POSTGRESQL
                  - ORACLE-RDS
                source:
                  - security-group:
                      - App
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Data
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: Main
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - segregated
          tgw-rt-propagate:
            - core
            - shared
          blackhole-route: true
          attach-subnets:
            - TGW
          options:
            - DNS-support
        description: The Test vpc in the Test OU.
        cidr-src: provided
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: The Test OU.
  Prod:
    type: workload
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
    default-budgets:
      name: Default Prod Budget
      period: Monthly
      amount: 1000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    certificates:
      - name: Prod-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
    alb:
      - name: Core
        scheme: internal
        action-type: forward
        ip-type: ipv4
        listeners: HTTPS
        ports: 443
        vpc: Prod
        subnets: Web
        cert-name: Prod-EntrustCert
        security-policy: ELBSecurityPolicy-FS-1-2-Res-2019-08
        security-group: Web
        access-logs: true
        targets:
          - target-name: health-check-Lambda
            target-type: lambda
            health-check-path: /health-check
            lambda-filename: internal-prod-alb-lambda.txt
    vpc:
      - deploy: shared-network
        name: Prod
        cidr:
          - value: 10.4.0.0/16
            size: 16
            pool: main
          - value: 10.14.0.0/16
            size: 16
            pool: secondary
        region: ${HOME_REGION}
        use-central-endpoints: true
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: TGW
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.88.0/27
                  pool: main
                  size: 27
              - az: b
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.88.32/27
                  pool: main
                  size: 27
              - az: d
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.88.64/27
                  pool: main
                  size: 27
          - name: Web
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.32.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.128.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.192.0/20
                  pool: main
                  size: 20
          - name: App
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.0.0/19
                  pool: main
                  size: 19
              - az: b
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.96.0/19
                  pool: main
                  size: 19
              - az: d
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.160.0/19
                  pool: main
                  size: 19
          - name: Data
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.48.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.144.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.208.0/20
                  pool: main
                  size: 20
            nacls:
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: true
                cidr-blocks:
                  - vpc: Prod
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: true
                cidr-blocks:
                  - 0.0.0.0/0
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: false
                cidr-blocks:
                  - vpc: Prod
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: false
                cidr-blocks:
                  - 0.0.0.0/0
          - name: Mgmt
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.64.0/21
                  pool: main
                  size: 21
              - az: b
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.72.0/21
                  pool: main
                  size: 21
              - az: d
                route-table: ProdVPC_Common
                cidr:
                  value: 10.4.80.0/21
                  pool: main
                  size: 21
          - name: Database
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdVPC_Common
                cidr:
                  value: 10.14.16.0/22
                  pool: secondary
                  size: 22
              - az: b
                route-table: ProdVPC_Common
                cidr:
                  value: 10.14.20.0/22
                  pool: secondary
                  size: 22
              - az: d
                route-table: ProdVPC_Common
                cidr:
                  value: 10.14.24.0/22
                  pool: secondary
                  size: 22
          - name: Rosa
            share-to-ou-accounts: false
            share-to-specific-accounts:
              - ProdRosa
            definitions:
              - az: a
                route-table: ProdVPC_Common
                cidr:
                  value: 10.14.0.0/22
                  pool: main
                  size: 22
              - az: b
                route-table: ProdVPC_Common
                cidr:
                  value: 10.14.4.0/22
                  pool: main
                  size: 22
              - az: d
                route-table: ProdVPC_Common
                cidr:
                  value: 10.14.8.0/22
                  pool: main
                  size: 22
          - name: RosaControllers
            share-to-ou-accounts: false
            share-to-specific-accounts:
              - ProdRosa
            definitions:
              - az: a
                route-table: DevVPC_Common
                cidr:
                  value: 10.14.12.0/26
                  pool: main
                  size: 26
              - az: b
                route-table: DevVPC_Common
                cidr:
                  value: 10.14.12.64/26
                  pool: main
                  size: 26
              - az: d
                route-table: DevVPC_Common
                cidr:
                  value: 10.14.12.128/26
                  pool: main
                  size: 26
        gateway-endpoints:
          - s3
          - dynamodb
        route-tables:
          - name: ProdVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
        security-groups:
          - name: Mgmt
            inbound-rules:
              - description: Mgmt RDP/SSH Traffic Inbound
                type:
                  - RDP
                  - SSH
                source:
                  - 10.0.0.0/8
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Web
            inbound-rules:
              - description: World Web Traffic Inbound
                type:
                  - HTTP
                  - HTTPS
                source:
                  - 0.0.0.0/0
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: SC2G HealthCheck Inbound
                tcp-ports:
                  - 8008
                source:
                  - 169.254.24.170/32
                  - 169.254.148.70/32
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: App
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local Web Tier Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Web
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - App
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Data
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local App DB Traffic Inbound
                type:
                  - MSSQL
                  - MYSQL/AURORA
                  - REDSHIFT
                  - POSTGRESQL
                  - ORACLE-RDS
                source:
                  - security-group:
                      - App
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Data
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: Main
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - segregated
          tgw-rt-propagate:
            - core
            - shared
          blackhole-route: true
          attach-subnets:
            - TGW
          options:
            - DNS-support
        description: The Prod vpc in the Prod OU.
        cidr-src: provided
      - deploy: shared-network
        name: Prod_UsEast1
        cidr:
          - value: 10.6.0.0/16
            size: 16
            pool: main
        region: us-east-1
        use-central-endpoints: true
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: TGW
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.88.0/27
                  pool: main
                  size: 27
              - az: b
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.88.32/27
                  pool: main
                  size: 27
              - az: d
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.88.64/27
                  pool: main
                  size: 27
          - name: Web
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.32.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.128.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.192.0/20
                  pool: main
                  size: 20
          - name: App
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.0.0/19
                  pool: main
                  size: 19
              - az: b
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.96.0/19
                  pool: main
                  size: 19
              - az: d
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.160.0/19
                  pool: main
                  size: 19
          - name: Data
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.48.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.144.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.208.0/20
                  pool: main
                  size: 20
            nacls:
              - rule: 102
                protocol: -1
                ports: -1
                rule-action: deny
                egress: true
                cidr-blocks:
                  - vpc: Prod_UsEast1
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32002
                protocol: -1
                ports: -1
                rule-action: allow
                egress: true
                cidr-blocks:
                  - 0.0.0.0/0
              - rule: 102
                protocol: -1
                ports: -1
                rule-action: deny
                egress: false
                cidr-blocks:
                  - vpc: Prod_UsEast1
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32002
                protocol: -1
                ports: -1
                rule-action: allow
                egress: false
                cidr-blocks:
                  - 0.0.0.0/0
          - name: Mgmt
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.64.0/21
                  pool: main
                  size: 21
              - az: b
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.72.0/21
                  pool: main
                  size: 21
              - az: d
                route-table: ProdUsEast1VPC_Common
                cidr:
                  value: 10.6.80.0/21
                  pool: main
                  size: 21
        gateway-endpoints:
          - s3
          - dynamodb
        route-tables:
          - name: ProdUsEast1VPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
        security-groups:
          - name: Mgmt
            inbound-rules:
              - description: Mgmt RDP/SSH Traffic Inbound
                type:
                  - RDP
                  - SSH
                source:
                  - 10.0.0.0/8
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Web
            inbound-rules:
              - description: World Web Traffic Inbound
                type:
                  - HTTP
                  - HTTPS
                source:
                  - 0.0.0.0/0
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: App
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local Web Tier Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Web
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - App
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Data
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local App DB Traffic Inbound
                type:
                  - MSSQL
                  - MYSQL/AURORA
                  - REDSHIFT
                  - POSTGRESQL
                  - ORACLE-RDS
                source:
                  - security-group:
                      - App
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Data
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: UsEast1
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - segregated
          tgw-rt-propagate:
            - core
            - shared
          blackhole-route: true
          attach-subnets:
            - TGW
          options:
            - DNS-support
        description: The Prod_UsEast1 vpc in the Prod OU (us-east-1).
        cidr-src: provided
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: The Prod OU.
  Sandbox:
    type: workload
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sandbox
      - Guardrails-ISED
    default-budgets:
      name: Default Sandbox Budget
      period: Monthly
      amount: 200
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - Put-S3-Encryption
    aws-config:
      - excl-regions: []
        rules:
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: The Sandbox OU.
  Infrastructure:
    type: ignore
    scps:
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
      - Guardrails-Part-0-Core
    default-budgets:
      name: Default Infrastructure Budget
      period: Monthly
      amount: 1000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: >-
      The infrastructure OU is used to hold AWS accounts containing AWS
      infrastructure resources shared or utilized by the rest of the
      Organization.
  Inf-Dev:
    type: workload
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
    default-budgets:
      name: Default Inf-Dev Budget
      period: Monthly
      amount: 2000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    certificates:
      - name: InfDev-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
      - name: Test-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
      - name: Uat-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
    alb:
      - name: Core
        scheme: internal
        action-type: forward
        ip-type: ipv4
        listeners: HTTPS
        ports: 443
        vpc: InfDev
        subnets: Web
        cert-name: InfDev-EntrustCert
        security-policy: ELBSecurityPolicy-FS-1-2-Res-2019-08
        security-group: Web
        access-logs: true
        targets:
          - target-name: health-check-Lambda
            target-type: lambda
            health-check-path: /health-check
            lambda-filename: internal-dev-alb-lambda.txt
    vpc:
      - deploy: shared-network
        name: InfDev
        cidr:
          - value: 10.13.0.0/16
            size: 16
            pool: main
        region: ${HOME_REGION}
        use-central-endpoints: true
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: TGW
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.88.0/27
                  pool: main
                  size: 27
              - az: b
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.88.32/27
                  pool: main
                  size: 27
              - az: d
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.88.64/27
                  pool: main
                  size: 27
          - name: Web
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.32.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.128.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.192.0/20
                  pool: main
                  size: 20
          - name: App
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.0.0/19
                  pool: main
                  size: 19
              - az: b
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.96.0/19
                  pool: main
                  size: 19
              - az: d
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.160.0/19
                  pool: main
                  size: 19
          - name: Data
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.48.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.144.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.208.0/20
                  pool: main
                  size: 20
            nacls:
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: true
                cidr-blocks:
                  - vpc: InfDev
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: true
                cidr-blocks:
                  - 0.0.0.0/0
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: false
                cidr-blocks:
                  - vpc: InfDev
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: false
                cidr-blocks:
                  - 0.0.0.0/0
          - name: Mgmt
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.64.0/21
                  pool: main
                  size: 21
              - az: b
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.72.0/21
                  pool: main
                  size: 21
              - az: d
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.80.0/21
                  pool: main
                  size: 21
          - name: GWLB
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.224.0/28
                  pool: main
                  size: 28
              - az: b
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.224.16/28
                  pool: main
                  size: 28
              - az: d
                route-table: InfDevVPC_Common
                cidr:
                  value: 10.13.224.32/28
                  pool: main
                  size: 28
        gateway-endpoints:
          - s3
          - dynamodb
        route-tables:
          - name: InfDevVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
        security-groups:
          - name: Mgmt
            inbound-rules:
              - description: Mgmt RDP/SSH Traffic Inbound
                type:
                  - RDP
                  - SSH
                source:
                  - 10.0.0.0/8
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Web
            inbound-rules:
              - description: World Web Traffic Inbound
                type:
                  - HTTP
                  - HTTPS
                source:
                  - 0.0.0.0/0
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: SC2G HealthCheck Inbound
                tcp-ports:
                  - 8008
                source:
                  - 169.254.24.170/32
                  - 169.254.148.70/32
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: App
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local Web Tier Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Web
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - App
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Data
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local App DB Traffic Inbound
                type:
                  - MSSQL
                  - MYSQL/AURORA
                  - REDSHIFT
                  - POSTGRESQL
                  - ORACLE-RDS
                source:
                  - security-group:
                      - App
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Data
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: Main
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - segregated
          tgw-rt-propagate:
            - core
            - shared
          blackhole-route: true
          attach-subnets:
            - TGW
          options:
            - DNS-support
        description: The InfDev vpc in the Inf-Dev OU.
        cidr-src: provided
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-inventory-collection: true
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: The Inf-Dev OU.
  CBPIE:
    type: workload
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED
    default-budgets:
      name: Default PIE Budget
      period: Monthly
      amount: 2000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: The Competition Bureau Investigation Lab OU.
  PerimeterTestingNoSCP:
    type: workload
    scps: []
    default-budgets:
      name: Default Sandbox Budget
      period: Monthly
      amount: 200
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - Put-S3-Encryption
    aws-config:
      - excl-regions: []
        rules:
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: An OU used for Perimeter networking components Testing
  Public-Buckets:
    type: workload
    scps:
      - Guardrails-Part-0
      - Guardrails-Part-1
      - Guardrails-Sensitive
      - Guardrails-ISED-Public-Buckets-Scp
    default-budgets:
      name: Default Public-Buckets Budget
      period: Monthly
      amount: 1000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    certificates:
      - name: PublicBuckets-EntrustCert
        type: import
        priv-key: "certs/example1-cert.key"
        cert: "certs/example1-cert.crt"
    alb:
      - name: Core
        scheme: internal
        action-type: forward
        ip-type: ipv4
        listeners: HTTPS
        ports: 443
        vpc: PublicBuckets
        subnets: Web
        cert-name: PublicBuckets-EntrustCert
        security-policy: ELBSecurityPolicy-FS-1-2-Res-2019-08
        security-group: Web
        access-logs: true
        targets:
          - target-name: health-check-Lambda
            target-type: lambda
            health-check-path: /health-check
            lambda-filename: internal-prod-alb-lambda.txt
    vpc:
      - deploy: shared-network
        name: PublicBuckets
        cidr:
          - value: 10.15.0.0/16
            size: 16
            pool: main
        region: ${HOME_REGION}
        use-central-endpoints: true
        flow-logs: CWL
        dns-resolver-logging: true
        subnets:
          - name: TGW
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.88.0/27
                  pool: main
                  size: 27
              - az: b
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.88.32/27
                  pool: main
                  size: 27
              - az: d
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.88.64/27
                  pool: main
                  size: 27
          - name: Web
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.32.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.128.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.192.0/20
                  pool: main
                  size: 20
          - name: App
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.0.0/19
                  pool: main
                  size: 19
              - az: b
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.96.0/19
                  pool: main
                  size: 19
              - az: d
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.160.0/19
                  pool: main
                  size: 19
          - name: Data
            share-to-ou-accounts: true
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.48.0/20
                  pool: main
                  size: 20
              - az: b
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.144.0/20
                  pool: main
                  size: 20
              - az: d
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.208.0/20
                  pool: main
                  size: 20
            nacls:
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: true
                cidr-blocks:
                  - vpc: PublicBuckets
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: true
                cidr-blocks:
                  - 0.0.0.0/0
              - rule: 101
                protocol: -1
                ports: -1
                rule-action: deny
                egress: false
                cidr-blocks:
                  - vpc: PublicBuckets
                    subnet:
                      - Web
                  - vpc: Central
                    subnet:
                      - Data
              - rule: 32001
                protocol: -1
                ports: -1
                rule-action: allow
                egress: false
                cidr-blocks:
                  - 0.0.0.0/0
          - name: Mgmt
            share-to-ou-accounts: false
            share-to-specific-accounts: []
            definitions:
              - az: a
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.64.0/21
                  pool: main
                  size: 21
              - az: b
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.72.0/21
                  pool: main
                  size: 21
              - az: d
                route-table: PublicBucketsVPC_Common
                cidr:
                  value: 10.15.80.0/21
                  pool: main
                  size: 21
        gateway-endpoints:
          - s3
          - dynamodb
        route-tables:
          - name: PublicBucketsVPC_Common
            routes:
              - destination: 0.0.0.0/0
                target: TGW
              - destination: s3
                target: s3
              - destination: DynamoDB
                target: DynamoDB
        security-groups:
          - name: Mgmt
            inbound-rules:
              - description: Mgmt RDP/SSH Traffic Inbound
                type:
                  - RDP
                  - SSH
                source:
                  - 10.0.0.0/8
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Web
            inbound-rules:
              - description: World Web Traffic Inbound
                type:
                  - HTTP
                  - HTTPS
                source:
                  - 0.0.0.0/0
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: SC2G HealthCheck Inbound
                tcp-ports:
                  - 8008
                source:
                  - 169.254.24.170/32
                  - 169.254.148.70/32
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: App
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local Web Tier Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Web
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - App
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
          - name: Data
            inbound-rules:
              - description: Central VPC Traffic Inbound
                type:
                  - ALL
                source:
                  - vpc: Central
                    subnet:
                      - Web
                      - App
                      - Mgmt
                      - GCWide
              - description: Local Mgmt Traffic Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Mgmt
              - description: Local App DB Traffic Inbound
                type:
                  - MSSQL
                  - MYSQL/AURORA
                  - REDSHIFT
                  - POSTGRESQL
                  - ORACLE-RDS
                source:
                  - security-group:
                      - App
              - description: Allow East/West Communication Inbound
                type:
                  - ALL
                source:
                  - security-group:
                      - Data
            outbound-rules:
              - description: All Outbound
                type:
                  - ALL
                source:
                  - 0.0.0.0/0
        tgw-attach:
          associate-to-tgw: Main
          account: shared-network
          associate-type: ATTACH
          tgw-rt-associate:
            - segregated
          tgw-rt-propagate:
            - core
            - shared
          blackhole-route: true
          attach-subnets:
            - TGW
          options:
            - DNS-support
        description: The PublicBuckets vpc in the Public-Buckets OU.
        cidr-src: provided
    iam:
      users: []
      policies:
        - policy-name: Default-Boundary-Policy
          policy: boundary-policy.txt
      roles:
        - role: EC2-Default-SSM-AD-Role
          type: ec2
          ssm-log-archive-write-access: true
          policies:
            - AmazonSSMManagedInstanceCore
            - AmazonSSMDirectoryServiceAccess
            - CloudWatchAgentServerPolicy
          boundary-policy: Default-Boundary-Policy
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: The Public-Buckets OU.
  InfrastructureNoSCP:
    type: ignore
    scps: []
    default-budgets:
      name: Default Infrastructure Budget
      period: Monthly
      amount: 1000
      include:
        - Upfront-reservation-fees
        - Recurring-reservation-charges
        - Other-subscription-costs
        - Taxes
        - Support-charges
        - Discounts
      alerts:
        - type: Actual
          threshold-percent: 50
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 75
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 90
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
        - type: Actual
          threshold-percent: 100
          emails:
            - matarneh+ic.aws-budget-budget-aws.ic@amazon.com
    ssm-automation:
      - account: operations
        regions:
          - ${HOME_REGION}
        documents:
          - SSM-ELB-Enable-Logging
          - Put-S3-Encryption
          - Attach-IAM-Instance-Profile
          - Attach-IAM-Role-Policy
    aws-config:
      - excl-regions:
          - ap-northeast-3
        rules:
          - EC2-INSTANCE-PROFILE
          - EC2-INSTANCE-PROFILE-PERMISSIONS
          - ELB_LOGGING_ENABLED
          - S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED
          - ACM_CERTIFICATE_EXPIRATION_CHECK
          - ALB_WAF_ENABLED
          - API_GW_CACHE_ENABLED_AND_ENCRYPTED
          - CLOUD_TRAIL_ENABLED
          - CLOUDTRAIL_S3_DATAEVENTS_ENABLED
          - CLOUDTRAIL_SECURITY_TRAIL_ENABLED
          - CLOUDWATCH_ALARM_ACTION_CHECK
          - CW_LOGGROUP_RETENTION_PERIOD_CHECK
          - DB_INSTANCE_BACKUP_ENABLED
          - DYNAMODB_IN_BACKUP_PLAN
          - DYNAMODB_TABLE_ENCRYPTED_KMS
          - EBS_IN_BACKUP_PLAN
          - EC2_INSTANCE_DETAILED_MONITORING_ENABLED
          - EC2_MANAGEDINSTANCE_PATCH_COMPLIANCE_STATUS_CHECK
          - EC2_VOLUME_INUSE_CHECK
          - ELASTICACHE_REDIS_CLUSTER_AUTOMATIC_BACKUP_CHECK
          - ELB_ACM_CERTIFICATE_REQUIRED
          - ELB_CROSS_ZONE_LOAD_BALANCING_ENABLED
          - EMR_KERBEROS_ENABLED
          - GUARDDUTY_NON_ARCHIVED_FINDINGS
          - IAM_GROUP_HAS_USERS_CHECK
          - IAM_PASSWORD_POLICY
          - IAM_USER_GROUP_MEMBERSHIP_CHECK
          - INCOMING_SSH_DISABLED
          - INSTANCES_IN_VPC
          - INTERNET_GATEWAY_AUTHORIZED_VPC_ONLY
          - RDS_IN_BACKUP_PLAN
          - REDSHIFT_CLUSTER_CONFIGURATION_CHECK
          - RESTRICTED_INCOMING_TRAFFIC
          - S3_BUCKET_POLICY_GRANTEE_CHECK
          - S3_BUCKET_VERSIONING_ENABLED
          - SAGEMAKER_ENDPOINT_CONFIGURATION_KMS_KEY_CONFIGURED
          - SAGEMAKER_NOTEBOOK_INSTANCE_KMS_KEY_CONFIGURED
          - SECURITYHUB_ENABLED
          - VPC_SG_OPEN_ONLY_TO_AUTHORIZED_PORTS
          - WAFV2_LOGGING_ENABLED
        remediate-regions:
          - ${HOME_REGION}
    description: >-
      The TESTING infrastructure OU is used to hold AWS accounts containing AWS
      infrastructure resources shared or utilized by the rest of the
      Organization.
